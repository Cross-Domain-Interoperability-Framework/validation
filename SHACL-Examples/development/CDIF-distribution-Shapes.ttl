@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix schema: <https://schema.org/> .
@prefix cdifd: <https://cdif.org/validation/0.1/shacl#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .
@prefix dcterms: <http://purl.org/dc/terms/>.
@prefix time: <http://www.w3.org/2006/time#>.
@prefix rdf:   <http://www.w3.org/1999/02/22-rdf-syntax-ns#>.

cdifd:CDIFDatasetRecommendedShape a sh:NodeShape ;
# only apply to elements that are child of root dataset
	sh:target [
	  a sh:SPARQLTarget ;
	  sh:prefixes (
		[ sh:prefix "schema" ; sh:namespace "https://schema.org/" ]
		[ sh:prefix "ada" ; sh:namespace "https://ada.astromat.org/metadata/" ]
		[ sh:prefix "xsd" ; sh:namespace "http://www.w3.org/2001/XMLSchema#" ]
		[ sh:prefix "dcterms" ; sh:namespace "http://purl.org/dc/terms/" ]
		[ sh:prefix "time" ; sh:namespace "http://www.w3.org/2006/time#"]
		[ sh:prefix "rdf" ; sh:namespace "http://www.w3.org/1999/02/22-rdf-syntax-ns#"]
	  ) ;
	  sh:select """
		SELECT ?this WHERE {
		  ?this a schema:Dataset .
		  FILTER NOT EXISTS {
			?parent a schema:Dataset .
			?parent ?p ?this .
			FILTER (?parent != ?this)
		  }
		}
	  """ ;
	] ;	
    sh:property	
		
		cdifd:getResourceProperty,
		cdifd:distributionProperty;
		#cdifd:distributionAgentProperty,
		#cdifd:metadataMetadataProperty,
        #cdifd:checksumProperty,
		#cdifd:citationProperty,
		# +
		#cdifd:subjectOfProperty,
		#cdifd:hasPartProperty,
		# +
.


cdifd:getResourceProperty
	a sh:PropertyShape ;
	sh:path [ sh:alternativePath ( schema:url schema:distribution ) ] ;
    sh:minCount 1 ;
	sh:severity sh:Warning;
	sh:message "Provide either a schema:url that will get a landing page with information on how to obtain the dataset, or provide a schema:distribution/schema:DataDownload or a schema:WebAPI that documents direct access to download the described dataset. Different DataDownloads can be offered with different formats. Use schema:WebAPI do document service-based access to the data";
.
		
cdifd:distributionProperty
	a sh:PropertyShape;
	sh:path schema:distribution ;
			sh:or( [sh:class  schema:DataDownload;]
					[sh:class schema:WebAPI; ]
					);
			sh:minCount 1;
			sh:message "a schema:distribution must have either a DataDownload or WebAPI value";
	.
			
cdifd:dataDownloadNode
	a sh:NodeShape; 
	sh:targetClass schema:DataDownload ;
	sh:property 	
		[
		sh:path schema:contentUrl ;
          sh:datatype xsd:string ;
          sh:minCount 1 ;
		sh:message "A DataDownload node must have  contentURL that will get the resource in question"
		];
	sh:property 	
		[
		sh:path schema:provider ;
			sh:or (  [  sh:class  schema:Person ]
             [sh:class  schema:Organization ] )  ;
        sh:minCount 0 ;
		sh:message "Providers must be specified with either a schema:Person or schema:Organization. If more than one data download option is offered, they can be associated with different providers"
		]
.
cdifd:webAPINode
	a sh:NodeShape; 
	sh:targetClass schema:WebAPI ;
	sh:property 	
		[sh:path schema:serviceType ;
			sh:or ( [sh:nodeKind sh:IRI] 
				[sh:datatype xsd:string] ) ;
			sh:minCount 1 ;
			sh:message "A WebAPI node must specify a service type with a string or IRI";
			sh:severity sh:Warning
		];
	sh:property 
		[sh:path schema:documentation;
			sh:or ( [sh:nodeKind sh:IRI] 
				[sh:datatype xsd:string] ) ;
			sh:message "a link or URL to a machine-actionable service distribution object should be provided if it exists";
			sh:minCount 1;
			sh:severity sh:Info
		];
	sh:property 
        [sh:path schema:potentialAction;
			sh:class schema:SearchAction;
			sh:property 	
				[sh:path schema:target;
					sh:class schema:EntryPoint;
						sh:property 	
							[sh:path schema:contentType;
								sh:datatype xsd:string;
							];
						sh:property
							[sh:path schema:urlTemplate;
								sh:datatype xsd:string;
								sh:minCount 1;
								sh:message "A web service distribution must include a URL; the CDIF schema allows URL Templates";
							];
						sh:property
							[sh:path schema:httpMethod;
								sh:datatype xsd:string;
							]
				];
			sh:property 	
				[sh:path schema:query-input;
					sh:class schema:PropertyValueSpecification;
                        sh:property
						[
							sh:path schema:valueName;
							sh:datatype xsd:string;
							sh:minCount 1;
							sh:message "if a URL template has query parameters, match the parameter name in this field and provide a description";
						];
                        sh:property
						[
							sh:path schema:description;
							sh:datatype xsd:string;
							sh:minCount 1;
							sh:message "provide a description for the query parameter";
						];
                        sh:property
						[
							sh:path schema:valueRequired;
							sh:datatype xsd:boolean;
							sh:message "valueRequired is specified by a boolean (not a string) value, either 'true' or 'false'";
						];
                ]
            ];
	sh:property 
		[sh:path schema:termsOfService;
			sh:or ( [sh:nodeKind sh:IRI] 
				[sh:datatype xsd:string] ) ;
			sh:minCount 1 ;
			sh:severity sh:Info;
			sh:message "condititions for use of the web api should be described in text of via IRI link to a document or web page"
		];
.
